<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Arhaszi</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body, html {
      width: 100%;
      height: 100%;
      margin: 0;
      background: radial-gradient(circle at center, rgba(0,0,0,0.7), #111), url('https://raw.githubusercontent.com/Luci13131313/Arhaszi/a856485e3cb45f6cce7c530ea3dce5a0bbdc7191/assets/images/FarcadeLogo.svg') center/contain no-repeat;
      background-blend-mode: overlay;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: 'Courier New', monospace;
    }

    #game-wrapper {
      max-width: 720px;
      margin: 0 auto;
      padding: 12px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 16px;
      height: 100vh;
    }

    #canvas-container {
      width: 360px;
      height: 480px;
      background: radial-gradient(circle at center, #35654d, #1f3d2c);
      border-radius: 16px;
      box-shadow: 0 0 12px #000;
      position: relative;
    }

    canvas {
      width: 100%;
      height: 100%;
      display: block;
    }

    #hud-panel {
      display: flex;
      flex-direction: column;
      gap: 6px;
      font-size: 14px;
      color: #0f0;
      background: linear-gradient(145deg, #333, #111);
      padding: 2px 16px;
      border-radius: 12px;
      border: 2px solid #0f0;
      box-shadow: 0 0 10px #0f0;
      width: 100%;
      font-family: 'Courier New', monospace;
    }

    #ai-coins-display {
      font-size: 14px;
      background: #000;
      color: #0f0;
      padding: 8px 12px;
      border: 2px dashed #0f0;
      border-radius: 10px;
      font-family: monospace;
      margin-right: 8px;
      align-self: center;
    }

    #control-panel {
      width: 100%;
      background: #222;
      border-radius: 12px;
      border: 2px inset #0f0;
      padding: 10px;
      box-shadow: 0 0 8px #0f0;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
    }

    .ai-coins {
      font-size: 12px;
      color: #0f0;
      background: #222;
      padding: 6px 12px;
      border: 2px dashed #0f0;
      border-radius: 10px;
      text-align: center;
      width: fit-content;
    }

    #bet-control {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: center;
    }

    .bet-btn {
      font-size: 10px;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      border: none;
      background: #333;
      color: white;
      cursor: pointer;
    }

    .btn {
      padding: 5px 14px;
      font-size: 14px;
      border-radius: 2px;
      border: none;
      background-color: #0a0;
      color: white;
      cursor: pointer;
    }

    #player-coins {
      font-size: 10px;
      color: #0f0;
      background: #222;
      padding: 4px 10px;
      border: 2px dashed #0f0;
      border-radius: 10px;
      text-align: center;
      width: fit-content;
    }

    @keyframes scrollLeft {
      0% { transform: translateX(100%); }
      100% { transform: translateX(-100%); }
    }

    #status-log.scroll-text {
      display: inline-block;
      white-space: nowrap;
      animation: scrollLeft 6s linear forwards;
    }

    #lucky-container {
      position: absolute;
      top: 10px; /* ‚¨áÔ∏è daha a≈üaƒüƒ± */
      right: 10px; /* ‚û°Ô∏è kartlarƒ±n saƒüƒ±nda */
      display: flex;
      flex-direction: column; /* üîÑ balon altta */
      align-items: flex-end;
      gap: 8px;
      z-index: 20;
      max-width: 110px;
    }

    #lucky-img {
      width: 64px;
      height: 64px;
      border-radius: 50%;
      border: 2px solid #000;
      object-fit: cover;
    }

    #lucky-speech {
      background: radial-gradient(circle at center, #35654d, #1f3d2c);
      color: yellow;
      border-radius: 10px;
      padding: 6px 10px;
      font-size: 10px;
      max-width: 120px;
      font-family: monospace;
      border: 1px solid #888;
      box-shadow: 1px 1px 4px rgba(0,0,0,0.1);
      word-break: break-word;
      white-space: normal;
      margin-top: 4px;
      text-align: left;
      align-self: flex-end;
    }

    #canvas-ai-coins {
      position: absolute;
      top: 10px;
      left: 10px;
    }

    #canvas-player-coins {
      position: absolute;
      bottom: 10px;
      left: 10px;
    }

    #canvas-control-panel {
      position: absolute;
      bottom: 130px;
      right: 90px;
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .floating-coins {
      font-size: 10px;
      background: #000;
      color: #0f0;
      padding: 6px 10px;
      border: 2px dashed #0f0;
      border-radius: 8px;
      font-family: monospace;
    }

    .card {
      width: 80px;
      height: 120px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      perspective: 1000px;
      margin: 10px;
    }

    .card-back {
      background: repeating-linear-gradient(45deg, #e5f4ff 0px, #e5f4ff 4px, #cde6ff 4px, #cde6ff 8px);
      background-image: url('https://raw.githubusercontent.com/Luci13131313/Arhaszi/53b2f509563e588300c0c720c85d70f3f3b2cb00/assets/images/Farcade1Logo.svg');
      background-size: 32px;
      background-repeat: repeat;
      background-position: center;
      border: 2px solid #1e90ff;
      transform: rotateY(180deg);
    }

    .card-front {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      font-size: 28px;
      font-weight: bold;
      color: white;
      border-radius: 12px;
      border: 2px solid #fff;
      background: var(--card-bg, linear-gradient(145deg, #444, #222));
      position: relative;
    }

    .suit-icon {
      position: absolute;
      top: 6px;
      left: 6px;
      width: 20px;
      height: 20px;
    }

    .suit-icon-bottom {
      position: absolute;
      bottom: 6px;
      right: 6px;
      width: 20px;
      height: 20px;
    }

    .card-front.farcade {
      --card-bg: linear-gradient(145deg, #3f0d7a, #12042f);
      border-color: #ae78f2;
    }

    .card-front.noun {
      --card-bg: linear-gradient(145deg, #ffd700, #b8860b);
      border-color: #ffeb3b;
    }

    .card-front.luci {
      --card-bg: linear-gradient(145deg, #8b0000, #2c0000);
      border-color: #e53935;
    }

    .card-front.luci-inv {
      --card-bg: linear-gradient(145deg, #202040, #000020);
      border-color: #6c63ff;
    }

    .card-front.doodle {
      --card-bg: linear-gradient(145deg, #40c9a2, #2f7763);
      border-color: #7ef9ff;
    }

  </style>
</head>
<body>
  <div id="game-wrapper">
    <div id="hud-panel">
      <div style="display:flex; width:100%; justify-content:space-between; align-items:center; gap:12px;">
        <div id="level-info">Level: 1</div>
        <div id="round-info">Round: 1</div>
        <div id="score-info">Score: 0</div>
      </div>
      <div id="status-log" class="scroll-text" style="width:100%; height:24px; font-family:monospace; color:yellow; font-size:14px; overflow:hidden;"></div>
    </div>

    <div id="canvas-container">
      <canvas id="game-canvas"></canvas>    
      <!-- AI COINS -->
      <div id="canvas-ai-coins" class="floating-coins">AI: 100</div>    
      <!-- PLAYER COINS -->
      <div id="canvas-player-coins" class="floating-coins">You: 100</div>   
      <!-- BET CONTROLS -->
      <div id="canvas-control-panel">
        <button id="decrease-bet" class="bet-btn">‚àí</button>
        <span id="current-bet">1</span>
        <button id="increase-bet" class="bet-btn">+</button>
        <button id="place-bet" class="btn">Bet</button>
        <button id="pass-button" class="btn" style="background-color: #555;">Pass</button>
      </div>
      <!-- LUCKY -->
      <div id="lucky-container">
        <img id="lucky-img" src="https://github.com/Luci13131313/Arhaszi/blob/main/assets/images/Mr.%20Lucky.png?raw=true" alt="Mr. Lucky" />
        <div id="lucky-speech">...</div>
      </div>
      <div class="card card-front farcade">
        <img src="https://raw.githubusercontent.com/Luci13131313/Arhaszi/53b2f509563e588300c0c720c85d70f3f3b2cb00/assets/images/Farcade1Logo.svg" class="suit-icon" />
        7
        <img src="https://raw.githubusercontent.com/Luci13131313/Arhaszi/53b2f509563e588300c0c720c85d70f3f3b2cb00/assets/images/Farcade1Logo.svg" class="suit-icon-bottom" />
      </div>
      <div class="card card-back"></div>
    </div>    
    </div>    
  </div>

  <script>

    // [1] Canvas Setup & Draw Loop - Canvas ba≈ülangƒ±√ß ayarlarƒ±, resize, ba≈ülangƒ±√ß yazƒ±sƒ± vs.

    const suitIconMap = {
      farcade: new Image(),
      noun: new Image(),
      luci: new Image(),
      doodle: new Image()
    };

    suitIconMap.farcade.src = "https://raw.githubusercontent.com/Luci13131313/Arhaszi/main/assets/images/Farcade1Logo.svg";
    suitIconMap.noun.src = "https://raw.githubusercontent.com/Luci13131313/Arhaszi/main/assets/images/Noun%20Logo.svg";
    suitIconMap.luci.src = "https://raw.githubusercontent.com/Luci13131313/Arhaszi/fb95c12cb9f26c38f6153cb06e78a836287338c6/assets/images/LL%20(1).svg";
    suitIconMap.doodle.src = "https://github.com/Luci13131313/DrawDoodle/blob/main/assets/images/Hap.png?raw=true";

let deck = [];
let playerCards = [];
let aiCards = [];
let aiCard = null;
let round = 1;
let roundFee = 1;
let maxRounds = 10;
let isBlind = false;
let playerCoins = 100;
let aiCoins = 100;
let playerScore = 0;
let aiScore = 0;
let pot = 0;
let currentBet = 1;
let currentPlayer = null;
let turnStep = 0;
let playerActed = false;
let aiActed = false;  // Oyuncu ve AI sƒ±rayla oynadƒ±ƒüƒ±nda true olacak
let turnOrder = [];
let turnIndex = 0;  // 0 = player, 1 = ai, d√∂n√º≈ü√ºml√º gidecek
let gameState = "start-round";

const canvas = document.getElementById("game-canvas");
const ctx = canvas.getContext("2d");

//  [2] Deck System - generateDeck(), shuffleDeck(), deal logic

const suitIcons = {
  farcade: "https://raw.githubusercontent.com/Luci13131313/Arhaszi/53b2f509563e588300c0c720c85d70f3f3b2cb00/assets/images/Farcade1Logo.svg",
  noun: "https://raw.githubusercontent.com/Luci13131313/Arhaszi/53b2f509563e588300c0c720c85d70f3f3b2cb00/assets/images/Noun%20Logo.svg",
  doodle: "https://github.com/Luci13131313/DrawDoodle/blob/main/assets/images/Hap.png?raw=true",
  luci: "https://raw.githubusercontent.com/Luci13131313/Arhaszi/fb95c12cb9f26c38f6153cb06e78a836287338c6/assets/images/LL%20(1).svg",
};


function generateDeck() {
  deck = [];
  const suits = ["farcade", "noun", "doodle", "luci"];
  for (let i = 1; i <= 13; i++) {
    for (let suit of suits) {
      deck.push({ value: i, suit });
    }
  }
  shuffleDeck(deck);
}


function createCardElement(value, suit, isFront = true) {
  const card = document.createElement("div");
  card.className = `card ${isFront ? "card-front" : "card-back"} ${suit}`;

  if (isFront) {
    const topIcon = document.createElement("img");
    topIcon.src = suitIcons[suit];
    topIcon.className = "suit-icon";
    card.appendChild(topIcon);

    const val = document.createElement("div");
    val.innerText = value;
    card.appendChild(val);

    const bottomIcon = document.createElement("img");
    bottomIcon.src = suitIcons[suit];
    bottomIcon.className = "suit-icon-bottom";
    card.appendChild(bottomIcon);
  }

  return card;
}

function shuffleDeck(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}

// [3] Card Distribution - dealPlayerCards(), drawPlayerCards()
// AI i√ßin ileride drawAICard() burada olacak


function dealAICards() {
  if (deck.length < 2) generateDeck();
  aiCards = [deck.pop(), deck.pop()].sort((a, b) => a - b);
}

function drawPlayerCards() {
  const cardWidth = 50;
  const cardHeight = 70;
  const spacing = 20;
  const totalWidth = cardWidth * 2 + spacing;
  const startX = (canvas.width - totalWidth) / 2;
  const y = canvas.height - cardHeight - 40;

  for (let i = 0; i < playerCards.length; i++) {
    const card = playerCards[i];
    const x = startX + i * (cardWidth + spacing);

    ctx.fillStyle = "#fff";
    ctx.fillRect(x, y, cardWidth, cardHeight);
    ctx.strokeStyle = "#000";
    ctx.strokeRect(x, y, cardWidth, cardHeight);
    ctx.fillStyle = "#000";
    ctx.font = "28px Arial";
    ctx.textAlign = "center";
    ctx.fillText(card.value, x + cardWidth / 2, y + cardHeight / 2);

    if (suitIconMap[card.suit]) {
      ctx.drawImage(suitIconMap[card.suit], x + 4, y + 4, 20, 20);
      ctx.drawImage(suitIconMap[card.suit], x + cardWidth - 24, y + cardHeight - 24, 20, 20);
    }
  }
}

function drawAICard(reveal = false) {
  const cardWidth = 50;
  const cardHeight = 70;
  const x = (canvas.width - cardWidth) / 2;
  const y = 40;

  const card = aiCards[0];
  ctx.fillStyle = "#fff";
  ctx.fillRect(x, y, cardWidth, cardHeight);
  ctx.strokeStyle = "#000";
  ctx.strokeRect(x, y, cardWidth, cardHeight);
  ctx.fillStyle = "#000";
  ctx.font = "28px Arial";
  ctx.textAlign = "center";
  ctx.fillText(reveal ? card.value : "?", x + cardWidth / 2, y + cardHeight / 2);

  if (reveal && suitIconMap[card.suit]) {
    ctx.drawImage(suitIconMap[card.suit], x + 4, y + 4, 20, 20);
    ctx.drawImage(suitIconMap[card.suit], x + cardWidth - 24, y + cardHeight - 24, 20, 20);
  }
}


function drawAICards(reveal = false) {
  const cardWidth = 50;
  const cardHeight = 70;
  const spacing = 20;
  const totalWidth = cardWidth * 2 + spacing;
  const startX = (canvas.width - totalWidth) / 2;
  const y = 40;

  for (let i = 0; i < aiCards.length; i++) {
    const card = aiCards[i];
    const x = startX + i * (cardWidth + spacing);
    ctx.fillStyle = "#fff";
    ctx.fillRect(x, y, cardWidth, cardHeight);
    ctx.strokeStyle = "#000";
    ctx.strokeRect(x, y, cardWidth, cardHeight);
    ctx.fillStyle = "#000";
    ctx.font = "28px Arial";
    ctx.textAlign = "center";
    ctx.fillText(reveal ? card.value : "?", x + cardWidth / 2, y + cardHeight / 2);

    if (reveal && suitIconMap[card.suit]) {
      ctx.drawImage(suitIconMap[card.suit], x + 4, y + 4, 20, 20);
      ctx.drawImage(suitIconMap[card.suit], x + cardWidth - 24, y + cardHeight - 24, 20, 20);
    }
  }
}

function rollDiceForTurn() {
  let playerRoll = Math.ceil(Math.random() * 6);
  let aiRoll = Math.ceil(Math.random() * 6);
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.fillStyle = "#fff";
  ctx.font = "24px Arial";
  ctx.textAlign = "center";
  ctx.fillText(`Dice Rolling...`, canvas.width / 2, canvas.height / 2 - 40);
  ctx.fillText(`AI: ${aiRoll}`, canvas.width / 2, canvas.height / 2);
  ctx.fillText(`You: ${playerRoll}`, canvas.width / 2, canvas.height / 2 + 30);

  if (playerRoll > aiRoll) {
    turnOrder = ["player", "ai"];
    ctx.fillText(`You will go first this level`, canvas.width / 2, canvas.height / 2 + 70);
  } else if (aiRoll > playerRoll) {
    turnOrder = ["ai", "player"];
    ctx.fillText(`Mr. Lucky will go first this level`, canvas.width / 2, canvas.height / 2 + 70);
  } else {
    ctx.fillText(`Tie! Rolling again...`, canvas.width / 2, canvas.height / 2 + 70);
    setTimeout(rollDiceForTurn, 1000);
    return;
  }

  turnIndex = 0;

  setTimeout(() => {
    drawStartText();
    drawAICards();
    advanceGameState();
  }, 1500);
}

function restartGame() {
  playerCoins = 100;
  aiCoins = 100;
  round = 1;
  pot = 0;
  generateDeck();
  updateInfoPanel();
  startRound();
  document.getElementById("result-banner").style.display = "none";
}

// ü™ô [4] Pot & Coin Management - Pot deƒüeri, animasyonlu g√ºncelleme, oyuncu/AI coin g√ºncellemeleri

function updateInfoPanel() {
  document.getElementById("round-info").innerText = `Round: ${round}`;
  document.getElementById("score-info").innerText = `P: ${playerScore} / AI: ${aiScore}`;
  document.getElementById("canvas-ai-coins").innerText = `Mr. Lucky Coins: ${aiCoins}`;
  document.getElementById("canvas-player-coins").innerText = `Your Coins: ${playerCoins}`;

  updateStatusMessage(`[Coins] Player: ${playerCoins}, AI: ${aiCoins}, Pot: ${pot}`);
}

function advanceGameState() {
  switch (gameState) {
    case "start-round":
      resetTable();
      updateStatusMessage(`--- Starting Round ${round} ---`);
      drawStartText();

      playerCoins -= roundFee;
      aiCoins -= roundFee;
      pot += 2 * roundFee;
      playerScore += roundFee;
      aiScore += roundFee;
      updateStatusMessage(`ü™ô ${roundFee} coin round fee paid by each player`);
      updateStatusMessage(`[Coins] Player: ${playerCoins}, AI: ${aiCoins}, Pot: ${pot}`);
      
      updateInfoPanel();
      
      gameState = "deal-cards";
      setTimeout(advanceGameState, 1000);
      break;

    case "deal-cards":
      updateStatusMessage("Dealing cards...");
      dealCards(() => {
        currentPlayer = turnOrder[turnIndex % 2];
        turnIndex++;
        gameState = currentPlayer === "player" ? "player-turn" : "ai-turn";
        advanceGameState();
      });
      break;

    case "player-turn":
      updateStatusMessage("It's your turn. You can bet or pass.");
      setPlayerButtons(true);
      break;

    case "ai-turn":
    updateStatusMessage("Mr. Lucky is deciding...");
      playAI(() => {
        gameState = "evaluate-turn";
        advanceGameState();
      });
      break;

      case "evaluate-turn":
  updateStatusMessage("Evaluating the round...");

  if (pot === 0) {
    updateStatusMessage("Pot is empty, ending round...");
    gameState = "end-round";
    setTimeout(advanceGameState, 1000);
    break;
  }

  if (playerActed && aiActed) {
    gameState = "end-round";
    setTimeout(advanceGameState, 1000);
  } else {
    if (!playerActed && currentPlayer !== "player") {
      currentPlayer = "player";
      gameState = "player-turn";
    } else if (!aiActed && currentPlayer !== "ai") {
      currentPlayer = "ai";
      gameState = "ai-turn";
    }
    setTimeout(advanceGameState, 500);
  }
  break;


  case "end-round":
  round++;
  updateInfoPanel();
  updateStatusMessage(`Round ${round} in 3...`);
  setTimeout(() => updateStatusMessage("2..."), 1000);
  setTimeout(() => updateStatusMessage("1..."), 2000);
  setTimeout(() => {
    if (round > maxRounds || playerCoins < roundFee || aiCoins < roundFee) {
      // Final skor hesaplama
      playerScore += playerCoins;
      aiScore += aiCoins;

      updateStatusMessage(`[FINAL COINS] Player: ${playerCoins}, AI: ${aiCoins}`);
      updateStatusMessage(`[FINAL SCORE] Player: ${playerScore}, AI: ${aiScore}`);

      if (playerScore > aiScore) {
        gameState = "level-won";
      } else {
        gameState = "game-over";
      }
    } else {
      gameState = "start-round";
    }
    advanceGameState();
  }, 3000);
  break;

    case "game-over":
      showResultBanner("Game Over", "#a00");
      updateStatusMessage("Game Over");
      break;

      case "level-won":
        showResultBanner("Level Complete!", "#0a0");
        updateStatusMessage(`You won the level with score ${playerScore}!`);
        break; 
  }
}

function dealCards(callback) {
  if (!turnOrder.length) return; // turnOrder yoksa daƒüƒ±tma
  playerCards = [];
  aiCards = [];
  aiCard = null;

  let delay = 0;
  const order = turnOrder;

  for (let i = 0; i < 2; i++) {
    for (let who of order) {
      setTimeout(() => {
        const card = deck.pop();
        if (who === "player") playerCards.push(card);
        else aiCards.push(card);
        drawStartText();
      }, delay);
      delay += 300;
    }
  }

  setTimeout(callback, delay + 100);
}


// [5] Game Logic & State - Round ba≈ülatma, kart sƒ±ralama, win/loss kontrol, turn deƒüi≈üimi vs.

function playAI(callback) {
  if (aiCards.length < 2 || deck.length < 1 || aiActed || currentPlayer !== 'ai') return;

  const [low, high] = aiCards.sort((a, b) => a - b);
  let validCards = 0;

  for (let card of deck) {
    if (card > low && card < high) {
      validCards++;
    }
  }

  const odds = validCards / deck.length;

  console.log(`AI Odds: ${Math.round(odds * 100)}%`);

  if (odds > 0.5 && aiCoins >= currentBet) {
    updateStatusMessage(`Mr. Lucky bets ${currentBet} coin`);
    updateStatusMessage(`Mr. Lucky risks ${currentBet} coins to draw between ${low + 1} and ${high - 1}`);
    aiCoins -= currentBet;
    pot += currentBet;
    aiScore += currentBet;
    updateInfoPanel();

    const drawn = deck.pop();

    setTimeout(() => {
      drawAICards(true);
      drawMiddleCard({ value: drawn, suit: aiCards[0].suit }, 'ai');

      let win = drawn > low && drawn < high;
      if (isBlind) win = drawn !== low && drawn !== high;

      if (win) {
        updateStatusMessage(`Mr. Lucky draws ${drawn}, wins ${Math.min(currentBet * 2, pot)} coins`);
        luckySays("Told ya. Luck's my middle name!");
        updateStatusMessage(`[Coins] Player: ${playerCoins}, AI: ${aiCoins}, Pot: ${pot}`);
        const reward = Math.min(currentBet * 2, pot);
        aiCoins += reward;
        pot -= reward;
        
      } else {
        updateStatusMessage(`Mr. Lucky draws ${drawn}, loses the bet`);
        updateStatusMessage(`[Coins] Player: ${playerCoins}, AI: ${aiCoins}, Pot: ${pot}`);
      }
      updateStatusMessage(`[Coins] Player: ${playerCoins}, AI: ${aiCoins}, Pot: ${pot}`);
      updateInfoPanel();
      aiActed = true;
      callback();
    }, 1000);

  } else {
    updateStatusMessage("Mr. Lucky passes the turn");
    luckySays("Meh!");
    
    aiActed = true;

    setTimeout(() => {
      drawAICards(false);
      callback();
    }, 500);
  }
}


function drawStartText() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  drawPotVisual();
  drawDeck(); // ‚Üê deste g√∂r√ºn√ºm√º i√ßin
  drawAICards(false); // sadece arka y√ºz
  drawPlayerCards(); // AI'nƒ±n altƒ±na eklenecek
}

function resetTable() {
  playerCards = [];
  aiCards = [];
  aiCard = null;
  aiActed = false;
  playerActed = false;
  drawStartText(); // temiz canvas + deste + pot
}

  function enablePlayerActions() {
  if (!playerActed && currentPlayer === 'player') {
    console.log("Your Turn");
    updateStatusMessage("Your Turn");
    setPlayerButtons(true);
  }
}

function resizeCanvas() {
  canvas.width = 360;
  canvas.height = 480;
  generateDeck();
  drawAICard(false);
  rollDiceForTurn(); // turnOrder belirlenir ‚Üí sonra advanceGameState √ßaƒürƒ±lƒ±r

}


window.addEventListener("resize", resizeCanvas);
resizeCanvas();

function setPlayerButtons(enabled) {
  const buttons = [document.getElementById("place-bet"), document.getElementById("pass-button")];
  buttons.forEach(btn => {
    btn.disabled = !enabled;
    btn.style.opacity = enabled ? 1 : 0.5;
    btn.style.cursor = enabled ? "pointer" : "not-allowed";
  });
}

// [6] UI Buttons & Interactions - Bet butonlarƒ±, pass, open/blind round se√ßimi

const betSpan = document.getElementById("current-bet");
const increaseBtn = document.getElementById("increase-bet");
const decreaseBtn = document.getElementById("decrease-bet");
const placeBetBtn = document.getElementById("place-bet");

increaseBtn.addEventListener("click", () => {
  if (currentBet < playerCoins) {
    if (currentBet >= 100) currentBet += 10;
    else if (currentBet >= 50) currentBet += 5;
    else if (currentBet >= 10) currentBet += 2;
    else currentBet += 1;
    if (currentBet > playerCoins) currentBet = playerCoins;
    betSpan.innerText = currentBet;
  }
});

decreaseBtn.addEventListener("click", () => {
  if (currentBet > 1) {
    if (currentBet > 100) currentBet -= 10;
    else if (currentBet > 50) currentBet -= 5;
    else if (currentBet > 10) currentBet -= 2;
    else currentBet -= 1;
    betSpan.innerText = currentBet;
  }
});

document.getElementById("place-bet").addEventListener("click", () => {
  if (playerActed || currentPlayer !== 'player' || playerCoins < currentBet) return;

  playerActed = true;
  setPlayerButtons(false);
  playerCoins -= currentBet;
  pot += currentBet;
  playerScore += currentBet;
  updateInfoPanel();
  aiCard = null;

  updateStatusMessage(`You bet ${currentBet} coin`);

  setTimeout(() => {
    aiCard = deck.pop();
    drawMiddleCard(aiCard, 'player');

    updateStatusMessage(`Your cards: ${playerCards[0]}, ${playerCards[1]}`);
    updateStatusMessage(`You bet ${currentBet} coin`);
    updateStatusMessage(`Drawn card: ${aiCard}`);

    const [low, high] = [...playerCards].sort((a, b) => a - b);
    let win = aiCard > low && aiCard < high;
    if (isBlind) win = aiCard !== low && aiCard !== high;

    if (win) {
  const reward = Math.min(currentBet * 2, pot);
      updateStatusMessage(`You win! You get ${reward} coins from the pot.`);
      playerCoins += reward;
      pot -= reward;
    } else {
      updateStatusMessage(`You lose the bet. ${currentBet} coins stay in the pot.`);
    }
    updateStatusMessage(`[Coins] Player: ${playerCoins}, AI: ${aiCoins}, Pot: ${pot}`);
    updateStatusMessage(`Pot after round: ${pot}`);
    updateInfoPanel();
    aiActed = true;

    gameState = "evaluate-turn";
    advanceGameState();
  }, 1000);
});

document.getElementById("pass-button").addEventListener("click", () => {
  if (playerActed || currentPlayer !== 'player') return;

  playerActed = true;
  setPlayerButtons(false);
  updateStatusMessage("You passed");

  // ‚úÖ G√ºncelleme: evaluate-turn state'e ge√ß
  gameState = "evaluate-turn";
  advanceGameState();
});

function showCenterMessage(msg, color) {
  ctx.font = "48px Arial";
  ctx.fillStyle = color;
  ctx.textAlign = "center";
  ctx.fillText(msg, canvas.width / 2, canvas.height / 2);
  setTimeout(() => {
    drawAICard();
  }, 1500);
}

//  [7] Visuals & Animation - Animasyonlar, kart titretme, pot parlamasƒ± vs.
function drawPotVisual() {
  const x = canvas.width / 2;
  const y = canvas.height / 2;
  ctx.beginPath();
  ctx.arc(x, y, 40, 0, 2 * Math.PI);
  ctx.fillStyle = "gold";
  ctx.fill();
  ctx.strokeStyle = "#000";
  ctx.lineWidth = 3;
  ctx.stroke();
  ctx.fillStyle = "#000";
  ctx.font = "22px Arial";
  ctx.textAlign = "center";
  ctx.fillText(`ü™ô ${pot}`, x, y + 8);
}

function drawDeck() {
  const cardWidth = 50;
  const cardHeight = 70;
  const x = canvas.width / 2 + 70;
  const y = canvas.height / 2 - cardHeight / 2;

  ctx.fillStyle = "#333";
  ctx.fillRect(x, y, cardWidth, cardHeight);
  ctx.strokeStyle = "#000";
  ctx.strokeRect(x, y, cardWidth, cardHeight);
  ctx.fillStyle = "#fff";
  ctx.font = "18px Arial";
  ctx.textAlign = "center";
  ctx.fillText("Deck", x + cardWidth / 2, y + cardHeight / 2 + 6);
}

function drawMiddleCard(card, player = 'player') {
  const cardWidth = 50;
  const cardHeight = 70;
  const spacing = 20;
  const totalWidth = cardWidth * 2 + spacing;
  const startX = (canvas.width - totalWidth) / 2;
  const y = player === 'player'
    ? canvas.height - cardHeight - 40
    : 40;

  let midX = startX + (cardWidth + spacing) / 2;

  ctx.fillStyle = "#fff";
  ctx.fillRect(midX, y, cardWidth, cardHeight);
  ctx.strokeStyle = "#000";
  ctx.strokeRect(midX, y, cardWidth, cardHeight);

  ctx.fillStyle = "#000";
  ctx.font = "28px Arial";
  ctx.textAlign = "center";
  ctx.fillText(card.value, midX + cardWidth / 2, y + cardHeight / 2);

  if (suitIconMap[card.suit]) {
  ctx.drawImage(suitIconMap[card.suit], midX + 4, y + 4, 20, 20);
  ctx.drawImage(suitIconMap[card.suit], midX + cardWidth - 24, y + cardHeight - 24, 20, 20);
}
}

function showResultBanner(text, color) {
  updateStatusMessage(text); // sadece log‚Äôa yaz
}

// [8] Score System & Level Progression - Score g√ºncelleme, round skoru, level atlama ≈üartlarƒ±

//  [9] Utility Functions - Yardƒ±mcƒ±lar: random, delay, formatting vs.

function updateStatusMessage(text) {
  const logEl = document.getElementById("status-log");
  if (logEl) {
    logEl.innerHTML = `‚Üí ${text}`;
    logEl.classList.remove("scroll-text");
    void logEl.offsetWidth; // restart animation trick
    logEl.classList.add("scroll-text");
  }
  console.log(`[STATUS]: ${text}`);
}

function luckySays(text) {
  const bubble = document.getElementById("lucky-speech");
  if (bubble) {
    bubble.innerText = text;
  }
}

  </script>
</body>
</html>
